{% extends 'base.html' %}
{% load bootstrap3 %}

{% block content %}
<div class="panel panel-default">
  <div class="panel-heading">
    <h3 class="panel-title">Show AutoSchedule {{ object.id }} Diff</h3>
  </div>
  <div class="panel-body">
    {% if diff %}
    <p class="lead">Showing the diff between AutoSchedule {{ object.id }} and AutoSchedule {{ original_schedule.id }}.</p>
    <table class="table">
      <caption>Event Differences - each row shows an event which changed time or location</caption>
      <thead>
        <tr>
          <th>Event</th>
          <th>Old Location</th>
          <th>New Location</th>
          <th>Old Start Time</th>
          <th>New Start Time</th>
        </tr>
      </thead>
      <tbody>
        {% for eventdiff in diff.event_diffs %}
        <tr>
            <td><a href="{% url "program:event_detail" camp_slug=camp.slug event_slug=eventdiff.event.slug %}">{{ eventdiff.event.title }}</a></td>
          <td>{{ eventdiff.old.eventlocation.name|default:"N/A" }}</td>
          <td>{{ eventdiff.new.eventlocation.name|default:"N/A" }}</td>
          <td>{{ eventdiff.old.starttime|default:"N/A" }}</td>
          <td>{{ eventdiff.new.starttime|default:"N/A" }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
    <table class="table">
      <caption>Slot Differences - each row represents a slot with changed content</caption>
      <thead>
        <tr>
          <th>EventLocation</th>
          <th>Start Time</th>
          <th>Old Event</th>
          <th>New Event</th>
        </tr>
      </thead>
      <tbody>
        {% for slotdiff in diff.slot_diffs %}
        <tr>
          <td>{{ slotdiff.eventlocation.name }}</td>
          <td>{{ slotdiff.starttime }}</td>
          <td>{{ slotdiff.old.event.title|default:"N/A" }}</td>
          <td>{{ slotdiff.new.event.title|default:"N/A" }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
    <a href="{% url 'backoffice:autoschedule_detail' camp_slug=camp.slug pk=object.id %}" class="btn btn-default"><i class="fas fa-undo"></i> Back</a>
    {% else %}
    <p class="lead">Show the difference between AutoSchedule {{ object.id }} and the AutoSchedule you pick below.</p>
    <div class="list-group">
      {% for schedule in schedules %}
      <a href="{% url 'backoffice:autoschedule_diff' camp_slug=camp.slug pk=object.id original_schedule_id=schedule.id %}" class="list-group-item">
        <h4 class="list-group-item-heading">AutoSchedule {{ schedule.id }}</h4>
        <p class="list-group-item-text">AutoSchedule {{ schedule.id }} was created by {{ schedule.user }} on {{ schedule.created }}. {% if schedule.applied %}It was applied on {{ schedule.applied }}.{% else %}It has never been applied.{% endif %}</p>
        <p class="list-group-item-text">It has {{ schedule.slots.count }} AutoSlots and {{ schedule.events.count }} AutoEvents.</p>
      </a>
      {% endfor %}
    </div>
    {% endif %}
  </div>
</div>
{% endblock content %}
