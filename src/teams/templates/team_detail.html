{% extends 'base.html' %}
{% load commonmark %}
{% load teams_tags %}
{% load bootstrap3 %}

{% block title %}
Team: {{ team.name }} | {{ block.super }}
{% endblock %}

{% block content %}

<h3>{{ team.name }} Team</h3>

{{ team.description|unsafecommonmark }}
<p>Currently {{ team.members.count }} people are members of this team{% if request.user in team.members.all %} (including you){% endif %}.</p>

{% if request.user in team.members.all %}
<p>Your team status: {% membershipstatus request.user team %}</p>
{% endif %}

{% if request.user in team.members.all %}
    <a href="{% url 'team_leave' camp_slug=camp.slug slug=team.slug %}" class="btn btn-danger">Leave Team</a>
{% else %}
    {% if team.needs_members %}
      <a href="{% url 'team_join' camp_slug=camp.slug slug=team.slug %}" class="btn btn-success">Join Team</a>
    {% endif %}
{% endif %}

<hr />
<h3>{{ team.area.name }} Area:</h3>
<p>This team is under the <b>{{ team.area.name }} area</b>. The following people are responsible for the <b>{{ team.name }} team</b>:</p>
<ul>
    {% for resp in team.responsible.all %}
    <li><b>{{ resp.get_full_name|default:"Unnamed" }}</b></li>
    {% endfor %}
</ul>

{% if request.user in team.responsible %}

<h3>Manage {{ team.name }} Team</h3>
<form method="post">
  {% csrf_token %}

  {% bootstrap_form form %}

  <hr />

  {% buttons %}
    <button class="btn btn-primary pull-right" type="submit">Save</button>
  {% endbuttons %}
</form>

<br />
<br />

<table class="table table-bordered table-hover">
  <thead>
    <tr>
      <th>
        Profile
      <th >
        Name
      <th>
        Status
      <th>
        Email
      <th>
        Description
      <th>
        Action

  <tbody>
  {% for member in team.teammember_set.all %}
  <tr>
    <td>
      {{ member.user }}
    <td>
      {{ member.user.profile.name }}
    <td>
      {{ member.approved }}
    <td>
      {{ member.user.profile.email }}
    <td>
      {{ member.user.profile.description }}
    <td>
      TBD
  {% endfor %}

{% endif %}

{% endblock %}
